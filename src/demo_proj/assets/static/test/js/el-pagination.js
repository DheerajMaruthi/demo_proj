'use strict';(function($){$.fn.endlessPaginate=function(options){var defaults={containerSelector:'.endless_container',loadingSelector:'.endless_loading',moreSelector:'a.endless_more',contentSelector:null,pageSelector:'.endless_page_template',pagesSelector:'a.endless_page_link',onClick:function(){},onCompleted:function(){},paginateOnScroll:false,paginateOnScrollMargin:1,paginateOnScrollChunkSize:0},settings=$.extend(defaults,options);var getContext=function(link){return{key:link.data("el-querystring-key").split(' ')[0],url:link.attr('href')};};return this.each(function(){var element=$(this),loadedPages=1;element.on('click',settings.moreSelector,function(){var link=$(this),html_link=link.get(0),content_wrapper=element.find(settings.contentSelector),container=link.closest(settings.containerSelector),loading=container.find(settings.loadingSelector);if(loading.is(':visible')){return false;}
link.hide();loading.show();var context=getContext(link);if(settings.onClick.apply(html_link,[context])!==false){var data='querystring_key='+context.key;$.get(context.url,data,function(fragment){loadedPages+=1;if(!content_wrapper.length){container.before(fragment);container.remove();}else{content_wrapper.append(fragment);var nextPage='page='+(loadedPages+1);link.attr('href',link.attr('href').replace(/page=\d+/,nextPage));link.show();loading.hide();}
settings.onCompleted.apply(html_link,[context,$.trim(fragment)]);}).fail(function(xhr,textStatus,error){container.remove();});}
return false;});if(settings.paginateOnScroll){var win=$(window),doc=$(document);doc.on('scroll',function(){if(doc.height()-win.height()-win.scrollTop()<=settings.paginateOnScrollMargin){var chunckSize=settings.paginateOnScrollChunkSize;if(!chunckSize||loadedPages%chunckSize){element.find(settings.moreSelector).trigger('click');}else{element.find(settings.moreSelector).addClass('endless_chunk_complete');}}});}
element.on('click',settings.pagesSelector,function(){var link=$(this),html_link=link.get(0),context=getContext(link);if(settings.onClick.apply(html_link,[context])!==false){var page_template=link.closest(settings.pageSelector),data='querystring_key='+context.key;page_template.load(context.url,data,function(fragment){settings.onCompleted.apply(html_link,[context,$.trim(fragment)]);});}
return false;});});};$.endlessPaginate=function(options){return $('body').endlessPaginate(options);};})(jQuery);